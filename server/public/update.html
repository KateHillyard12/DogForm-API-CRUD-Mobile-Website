<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GIMM 285 Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" type="text/css" href="Styling/stylesheets/updateStylesheet.css" />
</head>

<body>
  <div id="custom-cursor">
    <img src="Styling/images/WhitePawPrint.png" alt="Custom Cursor" />
  </div>

  <h1>Dog Form Data</h1>

  <div id="invalid-form" class="alert alert-danger">&nbsp;</div>

  <div id="success-form" class="alert alert-success">&nbsp;</div>

  <div id="border"></div>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h2>ADD IN A DOG OF YOUR OWN:</h2>
        <form id="DogForm">
          <div class="row">
            <div class="col-md-12">
              <label for="name" class="slide-in">What is the name of your dog?</label>
              <input type="text" id="name" class="slide-in" />
              <div class="row mb-3">
                <div id="name-error" class="col-6 text-danger">&nbsp;</div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <label for="breed" class="slide-in">What breed is your dog?</label>
              <select id="breed" class="slide-in">
                <option value=""></option>
                <option value="toy">Tiny Toy</option>
                <option value="work">Hard Worker</option>
                <option value="herd">Herder</option>
                <option value="sport">Speedy Sporty</option>
              </select>
              <div class="row mb-3">
                <div id="breed-error" class="col-6 text-danger">&nbsp;</div>
              </div>
            </div>
            <div class="col-md-4">
              <label for="fur" class="slide-in">What fur type does your dog have?</label>
              <select id="fur" class="slide-in">
                <option value=""></option>
                <option value="1">Smooth and Soft</option>
                <option value="2">Rough and Glossy</option>
                <option value="3">Corded and Bouncy</option>
                <option value="4">Extra Heavy coat</option>
                <option value="5">Silky and Shinny</option>
                <option value="6">Curly and Wavy</option>
                <option value="7">Wirey and Rugged</option>
                <option value="8">Hairless and Clean</option>
              </select>

              <div class="row mb-3">
                <div id="fur-error" class="col-12 text-danger">&nbsp;</div>
              </div>
            </div>
            <div class="col-md-4">
              <label for="color" class="slide-in">What color is your puppy?</label>
              <input type="text" id="color" class="slide-in" />
              <div class="row mb-3">
                <div id="color-error" class="col-12 text-danger">&nbsp;</div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <label for="energy" class="slide-in">How energized is your dog?</label>
              <select id="energy" class="slide-in">
                <option value=""></option>
                <option value="low">Chill</option>
                <option value="med">Excited</option>
                <option value="high">Zoomies x100</option>
              </select>
              <div class="row mb-3">
                <div id="energy-error" class="col-12 text-danger">&nbsp;</div>
              </div>
            </div>
            <div class="col-md-6">
              <label for="size" class="slide-in">How big is your puppy? (in text or in lbs)</label>
              <input type="text" id="size" class="slide-in" />
              <div class="row mb-3">
                <div id="size-error" class="col-12 text-danger">&nbsp;</div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="row">
        <div class="col-md-12">
          <button id="submit">ADD MY PUPPY</button>
        </div>
      </div>
    </div>
  </div>



  <script>
    //Javascript to handle animations and css
    // JavaScript to trigger the animation
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".slide-in").forEach(function (element) {
        element.classList.add("active");
      });
    });
    document.addEventListener("DOMContentLoaded", function () {
      var cursor = document.getElementById("custom-cursor");

      // Show the cursor when the page is loaded
      cursor.style.display = "block";

      //handles the click event
      function handleClick(event) {
        // Create a new image element for the paw print
        var pawPrint = document.createElement("img");
        pawPrint.src = "Styling/images/WhitePawPrint.png";
        pawPrint.classList.add("paw-print");

        // Calculate the position of the paw print relative to the viewport
        var pawPrintSize = 40; // Assuming the size of the cursor image is 40x40 pixels
        var pawPrintX = event.clientX - pawPrintSize / 2;
        var pawPrintY = event.clientY - pawPrintSize / 2 + window.pageYOffset; // Add scroll offset

        // Set the position of the paw print
        pawPrint.style.position = "absolute";
        pawPrint.style.left = pawPrintX + "px";
        pawPrint.style.top = pawPrintY + "px";

        // Set the size of the paw print
        pawPrint.style.width = pawPrintSize + "px";
        pawPrint.style.height = pawPrintSize + "px";

        // Append the paw print to the body
        document.body.appendChild(pawPrint);
      }

      // Add click event listener to the document
      document.addEventListener("click", handleClick);

      // Update cursor position on scroll
      window.addEventListener("scroll", function () {
        var x = event.clientX;
        var y = event.clientY + window.pageYOffset;
        cursor.style.left = x + "px";
        cursor.style.top = y + "px";
      });

      document.addEventListener("mousemove", function (event) {
        var x = event.clientX;
        var y = event.clientY;
        cursor.style.left = x + "px";
        cursor.style.top = y + "px";
      });

      // Update cursor position on scroll
      window.addEventListener("scroll", function () {
        var x = event.clientX;
        var y = event.clientY + window.pageYOffset;
        cursor.style.left = x + "px";
        cursor.style.top = y + "px";
      });
    });





    // JavaScript to handle the form submission

    const successForm = document.getElementById('success-form');
    const invalidForm = document.getElementById('invalid-form');

    successForm.style.display = 'none';
    invalidForm.style.display = 'none';

    const isEmpty = (obj) => Object.keys(obj).length === 0;

    let urlParams = new URLSearchParams(window.location.search);
    let DogId = urlParams.get('id');

    fetch(`http://localhost/dogs/${DogId}`, { method: 'GET' })
      .then((response) => {
        return new Promise((resolve) => response.json()
          .then((json) => resolve({
            status: response.status,
            json,
          })
          ));
      })
      .then(({ status, json }) => {
        if (200 === status) {
          console.log(json);
          let dogData = json.data[0];
          document.getElementById('name').value = dogData.name;
          document.getElementById('breed').value = dogData.breed;
          document.getElementById('fur').value = dogData.fur;
          document.getElementById('color').value = dogData.color;
          document.getElementById('energy').value = dogData.energy;
          document.getElementById('size').value = dogData.size;
          console.log(dogData);

        }
      })
      .catch(error => {
        console.error('Error: ', error);
      });

    console.log(urlParams);
    console.log(urlParams.get('dogId'));



    document.getElementById("submit").addEventListener("click", (event) => {
      const formData = new FormData();

      if (document.getElementById("name").value.length !== 0) {
        formData.append("name", document.getElementById("name").value);
      }
      if (document.getElementById("breed").value.length !== 0) {
        formData.append("breed", document.getElementById("breed").value);
      }
      if (document.getElementById("fur").value.length !== 0) {
        formData.append("fur", document.getElementById("fur").value);
      }
      if (document.getElementById("color").value.length !== 0) {
        formData.append("color", document.getElementById("color").value);
      }
      if (document.getElementById("energy").value.length !== 0) {
        formData.append("energy", document.getElementById("energy").value);
      }
      if (document.getElementById("size").value.length !== 0) {
        formData.append("size", document.getElementById("size").value);
      }

      formData.append('dogId', DogId);

      let fetchSettings = {
        method: 'PUT',
        body: formData,
      };


      fetch(`http://localhost/dogs/${DogId}`, fetchSettings)
        .then((response) => {
          return new Promise((resolve) => response.json()
            .then((json) => resolve({
              status: response.status,
              json,
            })
            ));
        })
        .then(({ status, json }) => {
          if (status === 400) {
            successForm.style.display = 'none'; // Hide the success message
            invalidForm.style.display = 'block'; // Show the error message
            invalidForm.innerHTML = json.message; // Display the error message from the server

            for (error of json.errors) {
              const errorId = error.path + '-error';
              document.getElementById(errorId).innerHTML = error.msg;
            }
          }
          else if (status === 200) {
            invalidForm.style.display = 'none'; // Hide the error message
            successForm.style.display = 'block'; // Show the success message
            successForm.innerHTML = json.message; // Display the success message from the server

            // Redirect to index.html after 3 seconds
            setTimeout(() => {
              window.location.href = 'index.html';
            }, 3000);
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
      return;
    });   
  </script>
</body>

</html>